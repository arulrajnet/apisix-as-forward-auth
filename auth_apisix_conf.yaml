routes:
  -
    uri: /__auth/*
    service_id: 1
    plugins:
      openid-connect:
        bearer_only: false
        client_id: ${{AUTH0_CLIENT_ID}}
        client_secret: ${{AUTH0_CLIENT_SECRET}}
        discovery: "https://${{AUTH0_DOMAIN}}/.well-known/openid-configuration"
        introspection_endpoint_auth_method: "client_secret_post"
        logout_path: "/logout"
        redirect_uri: "https://${{PORTAL_FQDN}}/__auth/callback"
        post_logout_redirect_uri: "https://${{PORTAL_FQDN}}/"
        scope: "openid profile email"
        set_refresh_token_header: true
        authorization_params:
          response_type: "code"
          audience: ${{AUTH0_AUDIENCE}}
        session:
          cookie:
            lifetime: 86400 #(integer, default: 3600): Lifetime of the session cookie in seconds.
            domain: ".${{PORTAL_FQDN}}"
          secret: ${{SESSION_SECRET}}

services:
  -
    id: 1
    upstream:
      nodes:
        "web1:80": 1
      type: roundrobin
  -
    id: 2
    upstream:
      nodes:
        "web2:80": 1
      type: roundrobin

#END
